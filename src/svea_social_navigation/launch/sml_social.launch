<?xml version="1.0"?>
<launch>

    <!-- Launch file arguments -->
    <arg name="map"             default="sml_planner"/>
    <arg name="is_mocap"        default="true"/>
    <arg name="is_sim"          default="true"/>
    <arg name="use_rviz"        default="true"/>
    <arg name="remote_rviz"     default="false"/>
    <arg name="obstacle_map"    default="sml_obstacles"/>
    <arg name="initial_pose_x"  default="-2.65488696"/>
    <arg name="initial_pose_y"  default="-1.64422277"/>
    <arg name="initial_pose_a"  default="1.57" /> <!-- wrt to map-->

    <!-- Start map server -->
    <node name="map_server" pkg="map_server" type="map_server" args="$(find svea_core)/maps/$(arg map).yaml" output="screen"/>

    <rosparam command="load" file="$(find svea_core)/params/$(arg obstacle_map).yaml" />

    <!-- If is_sim equal to false, then include all these tags-->
    <group unless="$(arg is_sim)">

        <!-- Start low-level interface -->
        <node name="serial_node" pkg="rosserial_python" type="serial_node.py">
            <param name="port" value="/dev/ttyACM0"/>
            <param name="baud" value="250000"/>
        </node>

        <group if="$(arg is_mocap)">
            <!-- Start localization -->
            <include file="$(find svea_sensors)/launch/localize.launch">
                <arg name="initial_pose_x" value="$(arg initial_pose_x)" />
                <arg name="initial_pose_y" value="$(arg initial_pose_y)" />
                <arg name="initial_pose_a" value="$(arg initial_pose_a)" />
            </include>
        </group>
    </group>

    <!-- Start RViz -->
    <node if="$(eval use_rviz and not remote_rviz)" name="rviz" pkg="rviz" type="rviz" args="-d $(find svea_core)/rviz/SVEA_floor2.rviz"/>
    <!-- Start pure_pursuit -->
    <node name="svea_social_navigation" pkg="svea_social_navigation" type="social_navigation.py" output="screen">
        <param name="use_rviz" value="$(arg use_rviz)"/>
        <param name="is_sim" value="$(arg is_sim)"/>
        <param name="remote_rviz" value="$(arg remote_rviz)" />
        <!-- Waypoints for floo2 map -->
        <rosparam>
            state: [7.8, 3.5, 1.57, 0] # initial state (x, y, yaw)
            goal: [6.9, 6.5]
        </rosparam>
    </node>
</launch>